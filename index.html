<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Automated Invoice Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --gap: 12px; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; background: #f7f7fb;}
    h1 { margin: 0 0 16px; }
    .card { background: #fff; border-radius: 14px; padding: 16px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); margin-bottom: 16px; }
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: var(--gap); }
    .col-6 { grid-column: span 6; }
    .col-4 { grid-column: span 4; }
    .col-3 { grid-column: span 3; }
    .col-2 { grid-column: span 2; }
    .col-12 { grid-column: span 12; }
    label { font-size: 12px; color: #333; display: block; margin-bottom: 6px; }
    input, textarea, select { width: 100%; padding: 10px 12px; border: 1px solid #e2e2ea; border-radius: 10px; background: #fff; }
    textarea { min-height: 84px; resize: vertical; }
    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: left; padding: 10px; border-bottom: 1px solid #eee; }
    th { background: #fafafa; font-weight: 600; }
    .row-actions button { margin-right: 6px; }
    .btn { border: 0; background: #111827; color: #fff; padding: 10px 14px; border-radius: 10px; cursor: pointer; }
    .btn.secondary { background: #374151; }
    .btn.ghost { background: #fff; color: #111827; border: 1px solid #ddd; }
    .totals { text-align: right; }
    .totals div { margin: 6px 0; }
    .flex { display: flex; align-items: center; gap: 8px; }
    .right { margin-left: auto; }
    small.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color:#666; }
    @media (max-width: 900px) { .col-6, .col-4, .col-3, .col-2 { grid-column: span 12; } }
  </style>
</head>
<body>
  <h1>Automated Invoice Generator</h1>

  <div class="card">
    <div class="grid">
      <div class="col-6">
        <label>Company Name</label>
        <input id="companyName" placeholder="ABC Solutions Pvt. Ltd." value="ABC Solutions Pvt. Ltd." />
      </div>
      <div class="col-6">
        <label>Company Email</label>
        <input id="companyEmail" placeholder="billing@abcsolutions.com" value="billing@abcsolutions.com" />
      </div>
      <div class="col-6">
        <label>Company Address</label>
        <textarea id="companyAddress" placeholder="123 Business Park, Mumbai">123 Business Park, Mumbai</textarea>
      </div>
      <div class="col-3">
        <label>Invoice No.</label>
        <input id="invoiceNumber" placeholder="INV-0001" />
      </div>
      <div class="col-3">
        <label>Invoice Date</label>
        <input id="invoiceDate" type="date" />
      </div>
      <div class="col-6">
        <label>Bill To (Client Name)</label>
        <input id="clientName" placeholder="XYZ Enterprises" value="XYZ Enterprises" />
      </div>
      <div class="col-6">
        <label>Client Email</label>
        <input id="clientEmail" placeholder="accounts@xyz.com" value="accounts@xyz.com" />
      </div>
      <div class="col-12">
        <label>Client Address</label>
        <textarea id="clientAddress" placeholder="789 Corporate Street, Delhi">789 Corporate Street, Delhi</textarea>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="flex">
      <h2 style="margin:0;">Items</h2>
      <button class="btn ghost right" id="addItemBtn">+ Add Item</button>
    </div>
    <div style="overflow-x:auto; margin-top:10px;">
      <table id="itemsTable">
        <thead>
          <tr>
            <th style="min-width:220px;">Description</th>
            <th>Qty</th>
            <th>Unit Price (₹)</th>
            <th>Tax %</th>
            <th>Line Total (₹)</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="itemsBody">
          <!-- Rows injected by JS -->
        </tbody>
      </table>
    </div>
    <div class="grid" style="margin-top:12px;">
      <div class="col-6">
        <label>Notes</label>
        <textarea id="notes" placeholder="Thank you for your business!">Thank you for your business!</textarea>
      </div>
      <div class="col-6 totals">
        <div><strong>Subtotal:</strong> <span id="subtotal">₹0.00</span></div>
        <div><strong>Total Tax:</strong> <span id="taxTotal">₹0.00</span></div>
        <div style="font-size:18px;"><strong>Grand Total:</strong> <span id="grandTotal">₹0.00</span></div>
        <small class="mono" id="amountWords"></small>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="flex">
      <div class="flex">
        <label for="currency">Currency</label>
        <select id="currency">
          <option value="INR" selected>INR (₹)</option>
          <option value="USD">USD ($)</option>
          <option value="EUR">EUR (€)</option>
        </select>
      </div>
      <div class="right flex">
        <button class="btn secondary" id="previewJson">Preview JSON</button>
        <button class="btn" id="generatePdf">Generate PDF</button>
      </div>
    </div>
  </div>

  <!-- jsPDF + AutoTable (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.3/dist/jspdf.plugin.autotable.min.js"></script>

  <script>
    // ===== Utilities =====
    const INR = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' });
    const USD = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
    const EUR = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' });

    function fmt(num, code) {
      if (code === 'INR') return INR.format(num);
      if (code === 'USD') return USD.format(num);
      if (code === 'EUR') return EUR.format(num);
      return num.toFixed(2);
    }

    function num(val) { return isNaN(+val) ? 0 : +val; }

    // Amount in words (basic, for INR)
    function amountInWords(n) {
      const a = ['','One','Two','Three','Four','Five','Six','Seven','Eight','Nine','Ten','Eleven',
                 'Twelve','Thirteen','Fourteen','Fifteen','Sixteen','Seventeen','Eighteen','Nineteen'];
      const b = ['','', 'Twenty','Thirty','Forty','Fifty','Sixty','Seventy','Eighty','Ninety'];
      function inWords(num) {
        if ((num = num.toString()).length > 9) return 'Amount too large';
        const n = ('000000000' + num).substr(-9).match(/(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})/);
        if(!n) return '';
        let str = '';
        const to19 = (x)=> x < 20 ? a[x] : b[Math.floor(x/10)] + (x%10 ? ' ' + a[x%10] : '');
        const hundreds = (x)=> x ? a[Math.floor(x/100)] + ' Hundred ' + (x%100 ? 'and ' + to19(x%100) : '') : '';
        str += n[1] != 0 ? to19(+n[1]) + ' Crore ' : '';
        str += n[2] != 0 ? to19(+n[2]) + ' Lakh ' : '';
        str += n[3] != 0 ? to19(+n[3]) + ' Thousand ' : '';
        str += n[4] != 0 ? a[+n[4]] + ' Hundred ' : '';
        str += n[5] != 0 ? (n[4] != 0 ? 'and ' : '') + to19(+n[5]) + ' ' : '';
        return str.trim();
      }
      const rupees = Math.floor(n);
      const paise = Math.round((n - rupees) * 100);
      let out = inWords(rupees) + ' Rupees';
      if (paise > 0) out += ' and ' + inWords(paise) + ' Paise';
      return out + ' Only';
    }

    // ===== Items State =====
    const itemsBody = document.getElementById('itemsBody');
    const currencySel = document.getElementById('currency');

    const state = {
      items: [
        { description: 'Web Development Services', qty: 1, price: 50000, tax: 18 },
        { description: 'Domain + Hosting (1 Year)', qty: 1, price: 5000, tax: 18 },
        { description: 'Maintenance', qty: 1, price: 10000, tax: 18 },
      ],
    };

    function rowHTML(item, idx) {
      return `
        <tr data-idx="${idx}">
          <td><input class="desc" value="${item.description ?? ''}" /></td>
          <td><input class="qty" type="number" min="0" step="1" value="${item.qty ?? 0}" /></td>
          <td><input class="price" type="number" min="0" step="0.01" value="${item.price ?? 0}" /></td>
          <td><input class="tax" type="number" min="0" step="0.01" value="${item.tax ?? 0}" /></td>
          <td class="lineTotal"></td>
          <td class="row-actions">
            <button class="btn ghost" data-action="dup">Duplicate</button>
            <button class="btn secondary" data-action="del">Delete</button>
          </td>
        </tr>
      `;
    }

    function renderItems() {
      itemsBody.innerHTML = state.items.map(rowHTML).join('');
      recalcTotals();
    }

    function recalcTotals() {
      const code = currencySel.value;
      let subtotal = 0, taxTotal = 0, grand = 0;

      [...itemsBody.querySelectorAll('tr')].forEach((tr, i) => {
        const qty = num(tr.querySelector('.qty').value);
        const price = num(tr.querySelector('.price').value);
        const tax = num(tr.querySelector('.tax').value);

        const lineBase = qty * price;
        const lineTax = lineBase * (tax / 100);
        const lineTotal = lineBase + lineTax;

        subtotal += lineBase;
        taxTotal += lineTax;
        grand += lineTotal;

        tr.querySelector('.lineTotal').textContent = fmt(lineTotal, code);
      });

      document.getElementById('subtotal').textContent = fmt(subtotal, code);
      document.getElementById('taxTotal').textContent = fmt(taxTotal, code);
      document.getElementById('grandTotal').textContent = fmt(grand, code);
      document.getElementById('amountWords').textContent = code === 'INR' ? amountInWords(grand) : '';
    }

    // Event delegation for table changes
    itemsBody.addEventListener('input', (e) => {
      const tr = e.target.closest('tr');
      const idx = +tr.dataset.idx;
      state.items[idx].description = tr.querySelector('.desc').value;
      state.items[idx].qty = num(tr.querySelector('.qty').value);
      state.items[idx].price = num(tr.querySelector('.price').value);
      state.items[idx].tax = num(tr.querySelector('.tax').value);
      recalcTotals();
    });

    itemsBody.addEventListener('click', (e) => {
      if (!e.target.dataset.action) return;
      const tr = e.target.closest('tr');
      const idx = +tr.dataset.idx;
      if (e.target.dataset.action === 'del') {
        state.items.splice(idx, 1);
      } else if (e.target.dataset.action === 'dup') {
        state.items.splice(idx + 1, 0, { ...state.items[idx] });
      }
      renderItems();
    });

    document.getElementById('addItemBtn').addEventListener('click', () => {
      state.items.push({ description: '', qty: 1, price: 0, tax: 0 });
      renderItems();
    });

    currencySel.addEventListener('change', recalcTotals);

    // ===== PDF Generation =====
    document.getElementById('generatePdf').addEventListener('click', async () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });

      const companyName = document.getElementById('companyName').value.trim() || 'Company';
      const companyEmail = document.getElementById('companyEmail').value.trim();
      const companyAddress = document.getElementById('companyAddress').value.trim();
      const invoiceNumber = document.getElementById('invoiceNumber').value.trim() || 'INV-' + Date.now();
      const invoiceDate = document.getElementById('invoiceDate').value || new Date().toISOString().slice(0,10);
      const clientName = document.getElementById('clientName').value.trim() || 'Client';
      const clientEmail = document.getElementById('clientEmail').value.trim();
      const clientAddress = document.getElementById('clientAddress').value.trim();
      const notes = document.getElementById('notes').value.trim();
      const code = currencySel.value;

      // Prepare table rows
      const rows = state.items.map(it => {
        const base = it.qty * it.price;
        const taxAmt = base * (it.tax / 100);
        const total = base + taxAmt;
        return [
          it.description || '-',
          String(it.qty || 0),
          fmt(it.price || 0, code),
          (it.tax || 0) + '%',
          fmt(total, code)
        ];
      });

      // Totals
      const sub = state.items.reduce((s, it) => s + (it.qty * it.price), 0);
      const tax = state.items.reduce((s, it) => s + (it.qty * it.price) * (it.tax / 100), 0);
      const grand = sub + tax;

      // Header
      doc.setFontSize(20);
      doc.text('INVOICE', 40, 50);

      doc.setFontSize(10);
      doc.text(companyName, 40, 80);
      if (companyEmail) doc.text(companyEmail, 40, 95);
      doc.text(companyAddress, 40, 110, { maxWidth: 250 });

      // Invoice meta
      doc.text(`Invoice No: ${invoiceNumber}`, 400, 80);
      doc.text(`Date: ${invoiceDate}`, 400, 95);

      // Bill To
      doc.setFontSize(12);
      doc.text('Bill To:', 40, 150);
      doc.setFontSize(10);
      doc.text(clientName, 40, 166);
      if (clientEmail) doc.text(clientEmail, 40, 181);
      doc.text(clientAddress, 40, 196, { maxWidth: 250 });

      // Items table
      doc.autoTable({
        startY: 230,
        head: [['Description', 'Qty', 'Unit Price', 'Tax %', 'Total']],
        body: rows,
        styles: { fontSize: 10, cellPadding: 6 },
        headStyles: { fillColor: [20, 20, 20], textColor: 255 },
        theme: 'striped',
        columnStyles: {
          0: { cellWidth: 230 },
          1: { cellWidth: 40, halign: 'right' },
          2: { cellWidth: 90, halign: 'right' },
          3: { cellWidth: 60, halign: 'right' },
          4: { cellWidth: 90, halign: 'right' },
        }
      });

      let y = doc.lastAutoTable.finalY + 20;

      // Totals block
      doc.setFontSize(10);
      doc.text(`Subtotal: ${fmt(sub, code)}`, 400, y); y += 16;
      doc.text(`Tax: ${fmt(tax, code)}`, 400, y); y += 16;
      doc.setFontSize(12);
      doc.text(`Grand Total: ${fmt(grand, code)}`, 400, y); y += 22;

      if (code === 'INR') {
        doc.setFontSize(9);
        doc.text(`Amount in words: ${amountInWords(grand)}`, 40, y, { maxWidth: 500 });
        y += 16;
      }

      // Notes
      if (notes) {
        doc.setFontSize(11);
        doc.text('Notes', 40, y);
        doc.setFontSize(10);
        doc.text(notes, 40, y + 16, { maxWidth: 500 });
      }

      doc.save(`${invoiceNumber}.pdf`);
    });

    // Preview JSON
    document.getElementById('previewJson').addEventListener('click', () => {
      const data = {
        company: {
          name: document.getElementById('companyName').value,
          email: document.getElementById('companyEmail').value,
          address: document.getElementById('companyAddress').value,
        },
        invoice: {
          number: document.getElementById('invoiceNumber').value || 'INV-' + Date.now(),
          date: document.getElementById('invoiceDate').value || new Date().toISOString().slice(0,10),
          currency: currencySel.value,
          items: state.items,
          notes: document.getElementById('notes').value,
          client: {
            name: document.getElementById('clientName').value,
            email: document.getElementById('clientEmail').value,
            address: document.getElementById('clientAddress').value,
          }
        }
      };
      alert(JSON.stringify(data, null, 2));
    });

    // Init defaults
    (function init() {
      document.getElementById('invoiceDate').value = new Date().toISOString().slice(0,10);
      document.getElementById('invoiceNumber').value = 'INV-0001';
      renderItems();
    })();
  </script>
</body>
</html>